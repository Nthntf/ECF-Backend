{% extends "layout/layout.html.twig" %}

{% block content %}
	<article class="bg-white rounded-2xl shadow-lg mx-auto my-8 p-6 max-w-7xl">
		<div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-6">
			<h1 class="text-2xl font-bold text-stone-700">Livres</h1>

			{% if role == 'admin' %}
				<button type="button" class="add-btn open-modal" data-resource="books" data-modal="add">
					+ Ajouter un livre
				</button>
			{% endif %}
		</div>

		<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
			{% for book in livres %}
				<div class="bg-stone-50 rounded-2xl border border-stone-200 shadow-sm hover:shadow-md hover:-translate-y-1 transition p-6 flex flex-col">
					{% if role == 'admin' %}
						<div class="flex justify-end gap-2 mb-3">
							<button class="update-btn open-modal" data-resource="books" data-modal="update" data-id="{{ book.id }}" data-titre="{{ book.titre }}" data-auteur_id="{{ book.auteur.id }}" data-categorie_id="{{ book.categorie.id }}" data-annee_publication="{{ book.annee_publication }}" data-isbn="{{ book.isbn }}" data-disponible="{{ book.disponible }}" data-like="{{ book.is_liked }}" data-synopsis="{{ book.synopsis|e('html_attr') }}">
								Modifier
							</button>

							<button type="button" class="delete-btn open-modal" data-resource="books" data-modal="delete" data-id="{{ book.id }}" data-titre="{{ book.titre }}">
								Supprimer
							</button>
						</div>
					{% endif %}

					<h2 class="text-xl font-semibold text-stone-800 mb-2">
						<a href="/books/{{ book.id }}" class="hover:underline">
							{{ book.titre }}
						</a>
					</h2>

					<div class="text-sm text-stone-600 space-y-1 mb-3">
						<a href="/authors/{{ book.auteur.id }}">
							<strong>Auteur :</strong>
							<span class="font-bold hover:underline hover:cursor-pointer">
								{{ book.auteur.prenom }}
								{{ book.auteur.nom }}
							</span>
						</a>
						<p>
							<strong>Catégorie :</strong>
							{{ book.categorie.nom }}
						</p>
						<p>
							<strong>Année :</strong>
							{{ book.annee_publication }}
						</p>
						<p>
							<strong>ISBN :</strong>
							{{ book.isbn }}
						</p>
						<p>
							<strong>Disponible :</strong>
							<span class="{{ book.disponible ? 'text-emerald-600' : 'text-red-500' }}">
								{{ book.disponible ? 'Oui' : 'Non' }}
							</span>
						</p>
					</div>
					<button class="like-btn self-start mb-3 flex items-center gap-2 transition hover:scale-105 {{ book.is_liked ? 'liked' : '' }}" data-id="{{ book.id }}">
						<svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="heart-icon h-6 w-6 transition-all duration-300">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z"/>
						</svg>
					</button>
					<div class="text-sm text-stone-600 leading-relaxed overflow-y-auto max-h-28 pr-1 ">
						{{ book.synopsis|raw }}
					</div>
				</div>
			{% else %}
				<p class="text-stone-500">
					Aucun livre trouvé
				</p>
			{% endfor %}
		</div>

		{% if paginator.numPages > 1 %}
			<div class="flex justify-center mt-8">
				<nav class="flex gap-2 items-center">
					{% if paginator.prevUrl %}
						<a href="{{ paginator.prevUrl }}" class="px-3 py-1 rounded bg-stone-200 hover:bg-stone-300">←</a>
					{% endif %}

					{% for page in paginator.pages %}
						<a href="{{ page.url }}" class="px-3 py-1 rounded {{ page.isCurrent ? 'bg-stone-700 text-white' : 'bg-stone-200 hover:bg-stone-300' }}">
							{{ page.num }}
						</a>
					{% endfor %}

					{% if paginator.nextUrl %}
						<a href="{{ paginator.nextUrl }}" class="px-3 py-1 rounded bg-stone-200 hover:bg-stone-300">→</a>
					{% endif %}
				</nav>
			</div>
		{% endif %}

	</article>

	{% if role == 'admin' %}
		<!-- Modal Ajouter -->
		<div id="modal-add" class="hidden modal fixed inset-0 bg-black/50 items-center justify-center">
			<form method="POST" action="/books/add" class="bg-white rounded p-6 w-150">
				<input type="text" name="titre" placeholder="Titre" class="border w-full my-1 px-2 py-1" required>
				<select name="auteur_id" class="border w-full my-1 px-2 py-1" required>
					<option value="">-- Choisir un auteur --</option>
					{% for auteur in auteurs %}
						<option value="{{ auteur.id }}">
							{{ auteur.prenom }}
							{{ auteur.nom }}
						</option>
					{% endfor %}
				</select>

				<select name="categorie_id" class="border w-full my-1 px-2 py-1" required>
					<option value="">-- Choisir une catégorie --</option>
					{% for categorie in categories %}
						<option value="{{ categorie.id }}">
							{{ categorie.nom }}
						</option>
					{% endfor %}
				</select>
				<input type="number" name="annee_publication" placeholder="Année de publication" class="border w-full my-1 px-2 py-1" required>
				<input type="text" name="isbn" placeholder="ISBN" class="border w-full my-1 px-2 py-1" required>

				<select name="disponible" class="border w-full my-1 px-2 py-1">
					<option value="1">Disponible</option>
					<option value="0">Indisponible</option>
				</select>

				<textarea name="synopsis" placeholder="Synopsis" class="border w-full my-1 px-2 py-1" required></textarea>

				<select name="like" class="border w-full my-1 px-2 py-1">
					<option value="0">Non aimé</option>
					<option value="1">Aimé</option>
				</select>

				<div class="flex justify-end gap-2 mt-4">
					<button type="button" class="cancel-btn close-modal">Annuler</button>
					<button class="add-btn">Ajouter</button>
				</div>
			</form>
		</div>

		<!-- Modal Supprimer -->
		<div id="modal-delete" class="hidden modal fixed inset-0 bg-black/50 items-center justify-center">
			<form method="POST" class="bg-white rounded p-6 w-96" id="deleteForm">
				<p class="delete-msg"></p>
				<div class="flex justify-end gap-2 mt-4">
					<button type="button" class="cancel-btn close-modal">Annuler</button>
					<button class="delete-btn">Supprimer</button>
				</div>
			</form>
		</div>

		<!-- Modal Modifier -->
		<div id="modal-update" class="hidden modal fixed inset-0 bg-black/50 items-center justify-center">
			<form method="POST" class="bg-white rounded p-6 w-150" id="updateForm">
				<input type="text" name="titre" id="updateTitre" class="border w-full my-1 px-2 py-1" required>
				<select name="auteur_id" id="updateAuteurId" class="border w-full my-1 px-2 py-1" required>
					{% for auteur in auteurs %}
						<option value="{{ auteur.id }}">
							{{ auteur.prenom }}
							{{ auteur.nom }}
						</option>
					{% endfor %}
				</select>

				<select name="categorie_id" id="updateCategorieId" class="border w-full my-1 px-2 py-1" required>
					{% for categorie in categories %}
						<option value="{{ categorie.id }}">
							{{ categorie.nom }}
						</option>
					{% endfor %}
				</select>
				<input type="number" name="annee_publication" id="updateAnnee" class="border w-full my-1 px-2 py-1" required>
				<input type="text" name="isbn" id="updateIsbn" class="border w-full my-1 px-2 py-1" required>

				<select name="disponible" id="updateDisponible" class="border w-full my-1 px-2 py-1">
					<option value="1">Disponible</option>
					<option value="0">Indisponible</option>
				</select>

				<textarea name="synopsis" id="updateSynopsis" class="border w-full my-1 px-2 py-1" required></textarea>

				<select name="like" id="updateLike" class="border w-full my-1 px-2 py-1">
					<option value="0">Non aimé</option>
					<option value="1">Aimé</option>
				</select>

				<div class="flex justify-end gap-2 mt-4">
					<button type="button" class="cancel-btn close-modal">Annuler</button>
					<button class="add-btn">Confirmer</button>
				</div>
			</form>
		</div>

	{% endif %}
{% endblock %}
