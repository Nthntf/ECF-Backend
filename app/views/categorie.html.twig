{% extends "layout/layout.html.twig" %}

{% block content %}
	<article class="rounded bg-stone-200 mx-auto w-fit py-5 px-10 my-5">
		<div class="flex justify-between items-center mb-4">
			{% if role === 'admin' %}
				<button type="button" class="add-btn open-modal" data-resource="categories" data-modal="add">
					+ Ajouter une catégorie
				</button>
			{% endif %}

			<form method="GET" action="" class="flex items-center gap-2">
				<label for="sort" class="text-sm text-stone-700">
					Trier par :
				</label>
				<select name="sort" id="sort" class="rounded border-stone-300 text-sm focus:ring-emerald-500 focus:border-emerald-500" onchange="this.form.submit()">
					<option value="id_asc">ID ↑</option>
					<option value="id_desc">ID ↓</option>
					<option value="name_asc">Nom A-Z</option>
					<option value="name_desc">Nom Z-A</option>
				</select>
			</form>
		</div>

		<table class="table-auto border-collapse">
			<thead>
				<tr class="border-b border-stone-400">
					<th class="px-6 py-3 text-left">ID</th>
					<th class="px-6 py-3 text-left">Nom</th>
					{% if role === 'admin' %}
						<th class="px-6 py-3 text-center">Modifier</th>
						<th class="px-6 py-3 text-center">Supprimer</th>
					{% endif %}

				</tr>
			</thead>

			<tbody>
				{% for categorie in categories %}
					<tr class="border-b border-stone-300">
						<td class="px-6 py-3">{{ categorie.id }}</td>
						<td class="px-6 py-3">{{ categorie.nom }}</td>

						{% if role === 'admin' %}
							<td class="px-6 py-3 text-center">
								<button class="update-btn open-modal" data-resource="categories" data-modal="update" data-id="{{ categorie.id }}" data-nom="{{ categorie.nom }}">
									Modifier
								</button>
							</td>

							<td class="px-6 py-3 text-center">
								<form method="POST" action="/categorie/{{ categorie.id }}/delete">
									<button type="button" class="delete-btn open-modal" data-resource="categories" data-modal="delete" data-id="{{ categorie.id }}" data-nom="{{ categorie.nom }}">
										Supprimer
									</button>
								</form>
							</td>
						{% endif %}

					</tr>
				{% else %}
					<tr>
						<td colspan="4" class="px-6 py-3 text-center">
							Aucune catégorie trouvée
						</td>
					</tr>
				{% endfor %}
			</tbody>
		</table>
	</article>
	{% if role === 'admin' %}
		<!-- Modal Ajouter -->
		<div id="modal-add" class="hidden modal fixed inset-0 bg-black/50 items-center justify-center">
			<form action="" method="POST" class="bg-white rounded p-6 w-96" id="addForm">
				<input type="text" name="nom" class="border-2 border-gray-300 px-3 py-1 my-1 w-full" placeholder="Nom catégorie" required>
				<div class="flex justify-end gap-2 mt-4">
					<button type="button" class="cancel-btn close-modal">Annuler</button>
					<button class="add-btn">Ajouter</button>
				</div>
			</form>
		</div>
		<!-- Modal Supprimer -->
		<div id="modal-delete" class="hidden modal fixed inset-0 bg-black/50 items-center justify-center">
			<form action="" method="POST" class="bg-white rounded p-6 w-96" id="deleteForm">
				<p class="delete-msg"></p>
				<div class="flex justify-end gap-2 mt-4">
					<button type="button" class="cancel-btn close-modal">Annuler</button>
					<button class="delete-btn">Supprimer</button>
				</div>
			</form>
		</div>
		<!-- Modal Modifier -->
		<div id="modal-update" class="hidden modal fixed inset-0 bg-black/50 items-center justify-center">
			<form action="" method="POST" class="bg-white rounded p-6 w-96" id="updateForm">
				<input type="text" name="nom" id="updateNom" class="border-2 border-gray-300 px-3 py-1 my-1 w-full" required>
				<div class="flex justify-end gap-2 mt-4">
					<button type="button" class="cancel-btn close-modal">Annuler</button>
					<button class="add-btn">Confirmer</button>
				</div>
			</form>
		</div>
	{% endif %}
{% endblock %}
